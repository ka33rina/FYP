---
title: "Geospatial Analysis using OneMap Data"
execute: 
  warning: false
date: "`r Sys.Date()`"
---

# Data Analysis

```{r}
pacman::p_load(arrow, lubridate, maptools, sp, sf, raster, spatstat, tmap, classInt, viridis, tidyverse, spNetwork)
```

Reading shapefiles that were exported from our qgis geopackage:

```{r}
desired_lines <- st_read(dsn = "data/geospatial", 
                 layer = "desired_lines")
```

```{r}
plot(desired_lines)
```

```{r}
target_buildings <- st_read(dsn = "data/geospatial", 
                 layer = "target_buildings")
```

```{r}
st_crs(target_buildings)
```

```{r}
tb_cat <- target_buildings["Categorize"]
```

```{r}
plot(tb_cat, key.width = lcm(6.32))
```

```{r}
mpsz <- st_read(dsn = "data/geospatial/MPSZ", layer = "MPSZ-2019")
```

```{r}
st_crs(mpsz)
```

```{r}
mpsz3414 <- st_transform(mpsz, 3414)
```

```{r}
st_crs(mpsz3414)
```

```{r}
plot(mpsz3414)
```

```{r}
plot(st_geometry(mpsz3414))
```

```{r}
plot(mpsz3414["PLN_AREA_N"])
```

```{r}
mpsz2 <- as_Spatial(mpsz3414)
```

extracting study areas:

```{r}
pg = mpsz2[mpsz2@data$PLN_AREA_N == "PUNGGOL",]
amk = mpsz2[mpsz2@data$PLN_AREA_N == "ANG MO KIO",]
```

```{r}
par(mfrow=c(2,2), mar = c(4, 4, 2, 1))
plot(pg, main = "Punggol")
plot(amk, main = "Ang Mo Kio")
```

```{r}
st_crs(pg)
```


```{r}
buildings_pg <- target_buildings3414[st_intersection(target_buildings3414, pg), ]
```

```{r}
tmap_mode("plot")


tm_basemap("OpenStreetMap")+
  tm_shape(downtown_core) +
    tm_borders(lwd=0.5) +
  tm_shape(roads_downtown_core) +
    tm_lines() +
  tm_shape(origin_downtown_core) +
    tm_dots()
```

```{r}
pg_sp = as(pg, "SpatialPolygons")
amk_sp = as(amk, "SpatialPolygons")
```

```{r}
pg_owin = as(pg_sp, "owin")
amk_owin = as(amk_sp, "owin")
```










